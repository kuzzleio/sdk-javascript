/*! Kuzzle javascript SDK version 5.0.10 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Kuzzle=t():e.Kuzzle=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t,r){var n="array"===t?!Array.isArray(r):("undefined"==typeof r?"undefined":l(r))!==t;if(n)throw new Error("Can only assign a "+t+' value to property "'+e+'"')}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var u=i.get;if(void 0!==u)return u.call(n)},a=r(19),f=r(1),d=r(10),p=r(2),y=r(16),h=r(12),v=r(5),b=r(13),m=function(e){function t(e,r){n(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(!e||""===e)throw new Error("host argument missing");if(Object.defineProperties(o,{eventActions:{value:["connected","discarded","disconnected","loginAttempt","networkError","offlineQueuePush","offlineQueuePop","queryError","reconnected","tokenExpired"]},autoResubscribe:{value:!r||"boolean"!=typeof r.autoResubscribe||r.autoResubscribe,enumerable:!0},defaultIndex:{value:r&&"string"==typeof r.defaultIndex?r.defaultIndex:void 0,writable:!0,enumerable:!0},jwt:{value:void 0,enumerable:!0,writable:!0},protocol:{value:r&&"string"==typeof r.protocol?r.protocol:"websocket",enumerable:!0},sdkVersion:{value:"5.0.10"},volatile:{value:{},enumerable:!0,writable:!0}}),r){var l=!0,s=!1,c=void 0;try{for(var f,d=Object.keys(r)[Symbol.iterator]();!(l=(f=d.next()).done);l=!0){var v=f.value;o.hasOwnProperty(v)&&Object.getOwnPropertyDescriptor(o,v).writable&&(o[v]=r[v])}}catch(e){s=!0,c=e}finally{try{!l&&d.return&&d.return()}finally{if(s)throw c}}}if(Object.defineProperty(o,"subscribe",{value:function(e,t,r){var n=this,i={requestId:a(),controller:"realtime",action:"subscribe",index:e.collection.index,collection:e.collection.collection,volatile:this.volatile,body:e.filters,scope:e.scope,state:e.state,users:e.users},o=function(t){if("TokenExpired"===t.type)return n.unsetJwt(),n.emit("tokenExpired");if("document"===t.type){var r=Object.assign({},t);return r.document=new p(e.collection,t.result._id,t.result._source,t.result._meta),delete r.result,e.notify(r)}e.notify(t)};void 0!==this.jwt&&(i.jwt=this.jwt),Object.assign(i.volatile,e.volatile,{sdkVersion:this.sdkVersion}),this.network.subscribe(i,t,o,r)}}),Object.defineProperty(o,"unsubscribe",{value:function(e,t){var r={requestId:a(),controller:"realtime",action:"unsubscribe",volatile:o.volatile,body:{roomId:e.roomId}};void 0!==o.jwt&&(r.jwt=o.jwt),Object.assign(r.volatile,e.volatile,{sdkVersion:o.sdkVersion}),o.network.unsubscribe(r,e.channel,t)}}),Object.defineProperty(o,"callbackRequired",{value:function(e,t){if(!t||"function"!=typeof t)throw new Error(e+": a callback argument is required for read queries")}}),Object.defineProperty(o,"security",{value:new y(o),enumerable:!0}),Object.defineProperty(o,"memoryStorage",{value:new h(o),enumerable:!0}),Object.defineProperty(o,"collections",{value:{},writable:!0}),Object.defineProperty(o,"eventTimeout",{value:r&&"number"==typeof r.eventTimeout?r.eventTimeout:200}),Object.defineProperty(o,"protectedEvents",{value:{connected:{timeout:o.eventTimeout},error:{timeout:o.eventTimeout},disconnected:{timeout:o.eventTimeout},reconnected:{timeout:o.eventTimeout},tokenExpired:{timeout:o.eventTimeout},loginAttempt:{timeout:o.eventTimeout}}}),o.network=b(o.protocol,e,r),Object.defineProperties(o,{autoQueue:{enumerable:!0,get:function(){return o.network.autoQueue},set:function(e){u("autoQueue","boolean",e),o.network.autoQueue=e}},autoReconnect:{enumerable:!0,get:function(){return o.network.autoReconnect}},autoReplay:{enumerable:!0,get:function(){return o.network.autoReplay},set:function(e){u("autoReplay","boolean",e),o.network.autoReplay=e}},host:{enumerable:!0,get:function(){return o.network.host}},offlineQueue:{enumerable:!0,get:function(){return o.network.offlineQueue}},offlineQueueLoader:{enumerable:!0,get:function(){return o.network.offlineQueueLoader},set:function(e){null!==e&&u("offlineQueueLoader","function",e),o.network.offlineQueueLoader=e}},port:{enumerable:!0,get:function(){return o.network.port}},queueFilter:{enumerable:!0,get:function(){return o.network.queueFilter},set:function(e){u("queueFilter","function",e),o.network.queueFilter=e}},queueMaxSize:{enumerable:!0,get:function(){return o.network.queueMaxSize},set:function(e){u("queueMaxSize","number",e),o.network.queueMaxSize=e}},queueTTL:{enumerable:!0,get:function(){return o.network.queueTTL},set:function(e){u("queueTTL","number",e),o.network.queueTTL=e}},replayInterval:{enumerable:!0,get:function(){return o.network.replayInterval},set:function(e){u("replayInterval","number",e),o.network.replayInterval=e}},reconnectionDelay:{enumerable:!0,get:function(){return o.network.reconnectionDelay}},sslConnection:{eumerable:!0,get:function(){return o.network.ssl}}}),o.network.addListener("offlineQueuePush",function(e){return o.emit("offlineQueuePush",e)}),o.network.addListener("offlineQueuePop",function(e){return o.emit("offlineQueuePop",e)}),o.network.addListener("queryError",function(e,t){return o.emit("queryError",e,t)}),o.network.addListener("tokenExpired",function(){o.unsetJwt(),o.emit("tokenExpired")}),o.bluebird){var m;return m=o.bluebird.promisifyAll(o,{suffix:"Promise",filter:function(e,t,r,n){var i=["getAllStatistics","getServerInfo","getStatistics","listCollections","listIndexes","login","logout","now","query","checkToken","whoAmI","updateSelf","getMyRights","getMyCredentials","createMyCredentials","deleteMyCredentials","updateMyCredentials","validateMyCredentials","createIndex","refreshIndex","getAutoRefresh","setAutoRefresh","connect"];return n&&i.indexOf(e)!==-1}}),i(o,m)}return o}return o(t,e),s(t,[{key:"emit",value:function(e){var r,n=Date.now(),i=this.protectedEvents[e];if(i){if(i.lastEmitted&&i.lastEmitted>n-i.timeout)return!1;i.lastEmitted=n}for(var o=arguments.length,u=Array(o>1?o-1:0),l=1;l<o;l++)u[l-1]=arguments[l];(r=c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"emit",this)).call.apply(r,[this,e].concat(u))}},{key:"connect",value:function(e){var t=this;return"offline"!==this.network.state?void(e&&e(null,this)):(this.network.connect(),this.network.addListener("connect",function(){t.emit("connected"),e&&e(null,t)}),this.network.addListener("networkError",function(r){var n=new Error("Unable to connect to kuzzle proxy server at "+t.network.host+":"+t.network.port);n.internal=r,t.emit("networkError",n),e&&e(n)}),this.network.addListener("disconnect",function(){t.disconnect(),t.emit("disconnected")}),this.network.addListener("reconnect",function(){t.jwt?t.checkToken(t.jwt,function(e,r){!e&&r.valid||t.unsetJwt(),t.emit("reconnected")}):t.emit("reconnected")}),void this.network.on("discarded",function(e){return t.emit("discarded",e)}))}},{key:"setJwt",value:function(e){if("string"==typeof e)this.jwt=e;else{if("object"!==("undefined"==typeof e?"undefined":l(e)))return this.emit("loginAttempt",{success:!1,error:"Invalid token argument: "+e}),this;if(!e.result||!e.result.jwt||"string"!=typeof e.result.jwt)return this.emit("loginAttempt",{success:!1,error:"Cannot find a valid JWT in the following object: "+JSON.stringify(e)}),this;this.jwt=e.result.jwt}return this.emit("loginAttempt",{success:!0}),this}},{key:"unsetJwt",value:function(){return this.jwt=void 0,this}},{key:"getJwt",value:function(){return this.jwt}},{key:"login",value:function(e){var t=this;if(!e||"string"!=typeof e)throw new Error("Kuzzle.login: strategy required");var r={strategy:e,body:{}},n=null;(arguments.length<=1?void 0:arguments[1])&&("object"===l(arguments.length<=1?void 0:arguments[1])?r.body=arguments.length<=1?void 0:arguments[1]:"number"==typeof(arguments.length<=1?void 0:arguments[1])||"string"==typeof(arguments.length<=1?void 0:arguments[1])?r.expiresIn=arguments.length<=1?void 0:arguments[1]:"function"==typeof(arguments.length<=1?void 0:arguments[1])&&(n=arguments.length<=1?void 0:arguments[1])),(arguments.length<=2?void 0:arguments[2])&&("number"==typeof(arguments.length<=2?void 0:arguments[2])||"string"==typeof(arguments.length<=2?void 0:arguments[2])?r.expiresIn=arguments.length<=2?void 0:arguments[2]:"function"==typeof(arguments.length<=2?void 0:arguments[2])&&(n=arguments.length<=2?void 0:arguments[2])),(arguments.length<=3?void 0:arguments[3])&&"function"==typeof(arguments.length<=3?void 0:arguments[3])&&(n=arguments.length<=3?void 0:arguments[3]),this.query({controller:"auth",action:"login"},r,{queuable:!1},function(e,r){e?(n&&n(e),t.emit("loginAttempt",{success:!1,error:e.message})):(r.result.jwt&&t.setJwt(r.result.jwt),n&&n(null,r.result))})}},{key:"createMyCredentials",value:function(e,t,r,n){return n||"function"!=typeof r||(n=r,r=null),this.query({controller:"auth",action:"createMyCredentials"},{strategy:e,body:t},r,function(e,t){"function"==typeof n&&n(e,e?void 0:t.result._source)}),this}},{key:"deleteMyCredentials",value:function(e,t,r){return r||"function"!=typeof t||(r=t,t=null),this.query({controller:"auth",action:"deleteMyCredentials"},{strategy:e},t,function(e,t){"function"==typeof r&&r(e,e?void 0:t.result)}),this}},{key:"getMyCredentials",value:function(e,t,r){r||"function"!=typeof t||(r=t,t=null),this.query({controller:"auth",action:"getMyCredentials"},{strategy:e},t,function(e,t){"function"==typeof r&&r(e,e?void 0:t.result)})}},{key:"updateMyCredentials",value:function(e,t,r,n){return n||"function"!=typeof r||(n=r,r=null),this.query({controller:"auth",action:"updateMyCredentials"},{strategy:e,body:t},r,function(e,t){"function"==typeof n&&n(e,e?void 0:t.result)}),this}},{key:"validateMyCredentials",value:function(e,t,r,n){n||"function"!=typeof r||(n=r,r=null),this.query({controller:"auth",action:"validateMyCredentials"},{strategy:e,body:t},r,function(e,t){"function"==typeof n&&n(e,e?void 0:t.result)})}},{key:"createIndex",value:function(e,t,r){if(!e){if(!this.defaultIndex)throw new Error("Kuzzle.createIndex: index required");e=this.defaultIndex}return r||"function"!=typeof t||(r=t,t=null),this.query({controller:"index",action:"create",index:e},{},t,function(e,t){"function"==typeof r&&r(e,e?void 0:t.result)}),this}},{key:"logout",value:function(e){var t=this,r={action:"logout",controller:"auth",requestId:a(),body:{}};return this.query({controller:"auth",action:"logout"},r,{queuable:!1},function(r){"function"==typeof e&&e(r,t)}),this.unsetJwt()}},{key:"checkToken",value:function(e,t){var r={body:{token:e}};this.callbackRequired("Kuzzle.checkToken",t),this.query({controller:"auth",action:"checkToken"},r,{queuable:!1},function(e,r){t(e,e?void 0:r.result)})}},{key:"whoAmI",value:function(e){var t=this;this.callbackRequired("Kuzzle.whoAmI",e),this.query({controller:"auth",action:"getCurrentUser"},{},{},function(r,n){e(r,r?void 0:new v(t.security,n.result._id,n.result._source,n.result._meta))})}},{key:"getMyRights",value:function(e,t){t||"function"!=typeof e||(t=e,e=null),this.callbackRequired("Kuzzle.getMyRights",t),this.query({controller:"auth",action:"getMyRights"},{},e,function(e,r){t(e,e?void 0:r.result.hits)})}},{key:"updateSelf",value:function(e,t,r){return r||"function"!=typeof t||(r=t,t=null),this.query({controller:"auth",action:"updateSelf"},{body:e},t,function(e,t){"function"==typeof r&&r(e,e?void 0:t.result)}),this}},{key:"addListener",value:function(e,r){if(this.eventActions.indexOf(e)===-1)throw new Error("["+e+"] is not a known event. Known events: "+this.eventActions.toString());return c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addListener",this).call(this,e,r)}},{key:"getAllStatistics",value:function(e,t){t||"function"!=typeof e||(t=e,e=null),this.callbackRequired("Kuzzle.getAllStatistics",t),this.query({controller:"server",action:"getAllStats"},{},e,function(e,r){t(e,e?void 0:r.result.hits)})}},{key:"getStatistics",value:function(){for(var e=void 0,t=void 0,r=void 0,n=void 0,i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];switch(o.length){case 1:n=o[0],e=null,t=null,r=null;break;case 2:"object"===l(o[0])?(r=o[0],n=o[1]):(e=o[0],n=o[1]);break;case 3:"object"===l(o[1])?(e=o[0],r=o[1],n=o[2]):(e=o[0],t=o[1],n=o[2]);break;case 4:e=o[0],t=o[1],r=o[2],n=o[3];break;default:throw new Error("Bad arguments list. Usage: kuzzle.getStatistics([startTime,] [stopTime,] [options,] callback)")}this.callbackRequired("Kuzzle.getStatistics",n);var s=function(t,r){return t?n(t):void n(null,e?r.result.hits:[r.result])},c={};e&&(c=t?{startTime:e,stopTime:t}:{startTime:e}),this.query({controller:"server",action:e?"getStats":"getLastStats"},c,r,s)}},{key:"collection",value:function(e,t){if(!t){if(!this.defaultIndex)throw new Error("Unable to create a new data collection object: no index specified");t=this.defaultIndex}if("string"!=typeof t||"string"!=typeof e)throw new Error("Invalid index or collection argument: string expected");return this.collections[t]||(this.collections[t]={}),this.collections[t][e]||(this.collections[t][e]=new d(this,e,t)),this.collections[t][e]}},{key:"flushQueue",value:function(){return this.network.flushQueue(),this}},{key:"listCollections",value:function(){for(var e=void 0,t=void 0,r=void 0,n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];var u=!0,s=!1,c=void 0;try{for(var a,f=i[Symbol.iterator]();!(u=(a=f.next()).done);u=!0){var d=a.value;switch("undefined"==typeof d?"undefined":l(d)){case"string":e=d;break;case"object":t=d;break;case"function":r=d}}}catch(e){s=!0,c=e}finally{try{!u&&f.return&&f.return()}finally{if(s)throw c}}if(!e){if(!this.defaultIndex)throw new Error("Kuzzle.listCollections: index required");e=this.defaultIndex}this.callbackRequired("Kuzzle.listCollections",r);var p={type:t&&t.type||"all"};this.query({index:e,controller:"collection",action:"list"},p,t,function(e,t){r(e,e?void 0:t.result.collections)})}},{key:"listIndexes",value:function(e,t){t||"function"!=typeof e||(t=e,e=null),this.callbackRequired("Kuzzle.listIndexes",t),this.query({controller:"index",action:"list"},{},e,function(e,r){t(e,e?void 0:r.result.indexes)})}},{key:"disconnect",value:function(){this.network.close();var e=!0,t=!1,r=void 0;try{for(var n,i=Object.keys(this.collections)[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o=n.value;delete this.collections[o]}}catch(e){t=!0,r=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}}},{key:"getServerInfo",value:function(e,t){t||"function"!=typeof e||(t=e,e=null),this.callbackRequired("Kuzzle.getServerInfo",t),this.query({controller:"server",action:"info"},{},e,function(e,r){t(e,e?void 0:r.result.serverInfo)})}},{key:"refreshIndex",value:function(){for(var e=void 0,t=void 0,r=void 0,n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];var u=!0,s=!1,c=void 0;try{for(var a,f=i[Symbol.iterator]();!(u=(a=f.next()).done);u=!0){var d=a.value;switch("undefined"==typeof d?"undefined":l(d)){case"string":e=d;break;case"object":t=d;break;case"function":r=d}}}catch(e){s=!0,c=e}finally{try{!u&&f.return&&f.return()}finally{if(s)throw c}}if(!e){if(!this.defaultIndex)throw new Error("Kuzzle.refreshIndex: index required");e=this.defaultIndex}return this.query({index:e,controller:"index",action:"refresh"},{},t,r),this}},{key:"getAutoRefresh",value:function(){for(var e=void 0,t=void 0,r=void 0,n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];var u=!0,s=!1,c=void 0;try{for(var a,f=i[Symbol.iterator]();!(u=(a=f.next()).done);u=!0){var d=a.value;switch("undefined"==typeof d?"undefined":l(d)){case"string":e=d;break;case"object":t=d;break;case"function":r=d}}}catch(e){s=!0,c=e}finally{try{!u&&f.return&&f.return()}finally{if(s)throw c}}if(!e){if(!this.defaultIndex)throw new Error("Kuzzle.getAutoRefresh: index required");e=this.defaultIndex}this.callbackRequired("Kuzzle.getAutoRefresh",r),this.query({index:e,controller:"index",action:"getAutoRefresh"},{},t,r)}},{key:"setAutoRefresh",value:function(){for(var e,t,r,n,i=arguments.length,o=Array(i),u=0;u<i;u++)o[u]=arguments[u];var s=!0,c=!1,a=void 0;try{for(var f,d=o[Symbol.iterator]();!(s=(f=d.next()).done);s=!0){var p=f.value;switch("undefined"==typeof p?"undefined":l(p)){case"string":e=p;break;case"boolean":t=p;break;case"object":r=p;break;case"function":n=p}}}catch(e){c=!0,a=e}finally{try{!s&&d.return&&d.return()}finally{if(c)throw a}}if(!e){if(!this.defaultIndex)throw new Error("Kuzzle.setAutoRefresh: index required");e=this.defaultIndex}if(void 0===t)throw new Error("Kuzzle.setAutoRefresh: autoRefresh value is required");return this.query({index:e,controller:"index",action:"setAutoRefresh"},{body:{autoRefresh:t}},r,n),this}},{key:"now",value:function(e,t){t||"function"!=typeof e||(t=e,e=null),this.callbackRequired("Kuzzle.now",t),this.query({controller:"server",action:"now"},{},e,function(e,r){t(e,e?void 0:r.result.now)})}},{key:"query",value:function(e,t,r,n){var i={action:e.action,controller:e.controller,volatile:this.volatile};if(n||"function"!=typeof r?n||r||"function"!=typeof t||(n=t,t={},r=null):(n=r,r=null),r){for(var o=["refresh","from","size","scroll","scrollId"],u=0;u<o.length;u++){var s=o[u];void 0!==r[s]&&(i[s]=r[s])}r.volatile&&"object"===l(r.volatile)&&Object.assign(i.volatile,r.volatile)}if(!t||"object"!==("undefined"==typeof t?"undefined":l(t))||Array.isArray(t))throw new Error("Invalid query parameter: "+t);Object.assign(i.volatile,t.volatile,{sdkVersion:this.sdkVersion});var c=!0,f=!1,d=void 0;try{for(var p,y=Object.keys(t)[Symbol.iterator]();!(c=(p=y.next()).done);c=!0){var h=p.value;"volatile"!==h&&(i[h]=t[h])}}catch(e){f=!0,d=e}finally{try{!c&&y.return&&y.return()}finally{if(f)throw d}}return void 0===this.jwt||"auth"===i.controller&&"checkToken"===i.action||(i.jwt=this.jwt),e.collection&&(i.collection=e.collection),e.index&&(i.index=e.index),i.requestId||(i.requestId=a()),this.network.query(i,r,n),this}},{key:"startQueuing",value:function(){return this.network.startQueuing(),this}},{key:"stopQueuing",value:function(){return this.network.stopQueuing(),this}},{key:"replayQueue",value:function(){return this.playQueue()}},{key:"playQueue",value:function(){return this.network.playQueue(),this}},{key:"setDefaultIndex",value:function(e){if("string"!=typeof e)throw new Error("Invalid default index: ["+e+"] (an index name is expected)");if(0===e.length)throw new Error("Cannot set an empty index as the default index");return this.defaultIndex=e,this}}]),t}(f);e.exports=m},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r(this,e),this.fn=t,this.once=n},u=function(){function e(){r(this,e),this._events={}}return i(e,[{key:"_exists",value:function(e,t){return Boolean(e.find(function(e){return e.fn===t}))}},{key:"listeners",value:function(e){return void 0===this._events[e]?[]:this._events[e].map(function(e){return e.fn})}},{key:"addListener",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||!t)return this;var i="undefined"==typeof t?"undefined":n(t);if("function"!==i)throw new Error("Invalid listener type: expected a function, got a "+i);return void 0===this._events[e]&&(this._events[e]=[]),this._exists(this._events[e],t)||this._events[e].push(new o(t,r)),this}},{key:"on",value:function(e,t){return this.addListener(e,t)}},{key:"prependListener",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e&&t?(void 0===this._events[e]&&(this._events[e]=[]),this._exists(this._events[e],t)||(this._events[e]=[new o(t,r)].concat(this._events[e])),this):this}},{key:"addOnceListener",value:function(e,t){return this.addListener(e,t,!0)}},{key:"once",value:function(e,t){return this.addOnceListener(e,t)}},{key:"prependOnceListener",value:function(e,t){return this.prependListener(e,t,!0)}},{key:"removeListener",value:function(e,t){var r=this._events[e];if(!r||!r.length)return this;var n=r.findIndex(function(e){return e.fn===t});return n!==-1&&r.splice(n,1),0===r.length&&delete this._events[e],this}},{key:"removeAllListeners",value:function(e){return e?delete this._events[e]:this._events={},this}},{key:"emit",value:function(e){var t=this._events[e];if(void 0===t)return!1;for(var r=[],n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];var u=!0,l=!1,s=void 0;try{for(var c,a=t[Symbol.iterator]();!(u=(c=a.next()).done);u=!0){var f=c.value;f.fn.apply(f,i),f.once&&r.push(f.fn)}}catch(e){l=!0,s=e}finally{try{!u&&a.return&&a.return()}finally{if(l)throw s}}var d=!0,p=!1,y=void 0;try{for(var h,v=r[Symbol.iterator]();!(d=(h=v.next()).done);d=!0){var b=h.value;this.removeListener(e,b)}}catch(e){p=!0,y=e}finally{try{!d&&v.return&&v.return()}finally{if(p)throw y}}return!0}},{key:"eventNames",value:function(){return Object.keys(this._events)}},{key:"listenerCount",value:function(e){return this._events[e]&&this._events[e].length||0}}]),e}();e.exports=u},function(e,t){function r(e,t,r,n){return Object.defineProperties(this,{collection:{value:e.collection,enumerable:!0},dataCollection:{value:e,enumerable:!1},kuzzle:{value:e.kuzzle,enumerable:!1},id:{value:void 0,enumerable:!0,writable:!0},content:{value:{},writable:!0,enumerable:!0},version:{value:void 0,enumerable:!0,writable:!0},meta:{value:n||{},enumerable:!0,writable:!1}}),!r&&t&&"object"==typeof t&&(r=t,t=null),r&&(r._version&&(this.version=r._version,delete r._version),this.setContent(r,!0)),t&&Object.defineProperty(this,"id",{value:t,enumerable:!0}),this.kuzzle.bluebird?this.kuzzle.bluebird.promisifyAll(this,{suffix:"Promise",filter:function(e,t,r,n){var i=["delete","refresh","save"];return n&&i.indexOf(e)!==-1}}):this}r.prototype.serialize=function(){var e={};return this.id&&(e._id=this.id),this.version&&(e._version=this.version),e.body=this.content,e.meta=this.meta,e},r.prototype.toString=function(){return JSON.stringify(this.serialize())},r.prototype.delete=function(e,t){var r=this;if(t||"function"!=typeof e||(t=e,e=null),!r.id)throw new Error("Document.delete: cannot delete a document without a document ID");this.kuzzle.query(this.dataCollection.buildQueryArgs("document","delete"),this.serialize(),e,t&&function(e){t(e,e?void 0:r.id)})},r.prototype.exists=function(e,t){var r=this;if(t||"function"!=typeof e||(t=e,e=null),!r.id)throw new Error("Document.exists: cannot check if the document exists if no id has been provided");this.kuzzle.query(this.dataCollection.buildQueryArgs("document","exists"),this.serialize(),e,t&&function(e,r){t(e,e?void 0:r.result)})},r.prototype.refresh=function(e,t){var n=this;if(t||"function"!=typeof e||(t=e,e=null),!n.id)throw new Error("Document.refresh: cannot retrieve a document if no ID has been provided");this.kuzzle.callbackRequired("Document.refresh",t),n.kuzzle.query(n.dataCollection.buildQueryArgs("document","get"),{_id:n.id},e,function(e,i){var o;return e?t(e):(o=new r(n.dataCollection,n.id,i.result._source,i.result._meta),o.version=i.result._version,void t(null,o))})},r.prototype.save=function(e,t){var r=this.serialize(),n=this;return e&&void 0===t&&"function"==typeof e&&(t=e,e=null),n.kuzzle.query(this.dataCollection.buildQueryArgs("document","createOrReplace"),r,e,function(e,r){return e?t&&t(e):(n.id=r.result._id,n.version=r.result._version,void(t&&t(null,n)))}),n},r.prototype.publish=function(e){var t=this.serialize();return this.kuzzle.query(this.dataCollection.buildQueryArgs("realtime","publish"),t,e),this},r.prototype.setContent=function(e,t){var r=this;return t?this.content=e:Object.keys(e).forEach(function(t){r.content[t]=e[t]}),this},r.prototype.subscribe=function(e,t){var r;if(e&&!t&&"function"==typeof e&&(t=e,e=null),this.kuzzle.callbackRequired("Document.subscribe",t),!this.id)throw new Error("Document.subscribe: cannot subscribe to a document if no ID has been provided");return r={ids:{values:[this.id]}},this.dataCollection.subscribe(r,e,t)},e.exports=r},function(e,t){function r(e,t,r,n){if(!t)throw new Error("A security document must have an id");if(Object.defineProperties(this,{kuzzle:{value:e.kuzzle},Security:{value:e},id:{value:t,enumerable:!0},content:{value:{},writable:!0,enumerable:!0},meta:{value:n||{},writable:!0,enumerable:!0}}),r&&this.setContent(r,!0),e.kuzzle.bluebird)return e.kuzzle.bluebird.promisifyAll(this,{suffix:"Promise",filter:function(e,t,r,n){var i=["delete","update"];return n&&i.indexOf(e)!==-1}})}r.prototype.setContent=function(e){return this.content=e,this},r.prototype.serialize=function(){var e={};return this.id&&(e._id=this.id),e.body=this.content,e.meta=this.meta,e},r.prototype.delete=function(e,t){var r=this;e&&void 0===t&&"function"==typeof e&&(t=e,e=null),r.kuzzle.query(this.Security.buildQueryArgs(this.deleteActionName),{_id:this.id},e,function(e,r){return e?!!t&&t(e):void(t&&t(null,r.result._id))})},r.prototype.update=function(e,t,r){var n={},i=this;if("object"!=typeof e)throw new Error('Parameter "content" must be a object');return t&&void 0===r&&"function"==typeof t&&(r=t,t=null),n._id=i.id,n.body=e,i.kuzzle.query(this.Security.buildQueryArgs(this.updateActionName),n,t,function(e,t){return e?!!r&&r(e):(i.setContent(t.result._source),void(r&&r(null,i)))}),this},e.exports=r},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t,r){(void 0!==t.jwt||r)&&e.once(t.requestId,function(n){var i=null;"logout"!==t.action&&n.error&&"Token expired"===n.error.message&&e.emit("tokenExpired",t,r),n.error&&(i=new Error(n.error.message),Object.assign(i,n.error),i.status=n.status,e.emit("queryError",i,t,r)),r&&r(i,n)}),e.requestHistory[t.requestId]=Date.now(),e.send(t)}function l(e,t){t&&t(new Error("Unable to execute request: not connected to a Kuzzle server.\nDiscarded request: "+JSON.stringify(e)))}function s(e){var t=Date.now(),r=-1;e.queueTTL>0&&(e.offlineQueue.forEach(function(n,i){n.ts<t-e.queueTTL&&(r=i)}),r!==-1&&e.offlineQueue.splice(0,r+1).forEach(function(t){e.emit("offlineQueuePop",t.query)})),e.queueMaxSize>0&&e.offlineQueue.length>e.queueMaxSize&&e.offlineQueue.splice(0,e.offlineQueue.length-e.queueMaxSize).forEach(function(t){e.emit("offlineQueuePop",t.query)})}function c(e){var t={},r=function t(){e.offlineQueue.length>0&&(u(e,e.offlineQueue[0].query,e.offlineQueue[0].cb),e.emit("offlineQueuePop",e.offlineQueue.shift()),setTimeout(function(){t()},Math.max(0,e.replayInterval)))};if(e.offlineQueueLoader){if("function"!=typeof e.offlineQueueLoader)throw new Error("Invalid value for offlineQueueLoader property. Expected: function. Got: "+f(e.offlineQueueLoader));var n=e.offlineQueueLoader();if(!Array.isArray(n))throw new Error("Invalid value returned by the offlineQueueLoader function. Expected: array. Got: "+("undefined"==typeof n?"undefined":f(n)));e.offlineQueue=n.concat(e.offlineQueue).filter(function(e){if(!e.query||void 0===e.query.requestId||!e.query.action||!e.query.controller)throw new Error("Invalid offline queue request. One or more missing properties: requestId, action, controller.");return!t.hasOwnProperty(e.query.requestId)&&(t[e.query.requestId]=!0)})}r()}function a(e){var t=Date.now();Object.keys(e).forEach(function(r){e[r]<t-1e4&&delete e[r]})}var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),p=r(1),y=function(e){function t(e,r){n(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(o,{cleanHistoryTimer:{value:null,writable:!0},host:{value:e,enumerable:!0},port:{value:r&&"number"==typeof r.port?r.port:7512,enumerable:!0},ssl:{value:!(!r||"boolean"!=typeof r.sslConnection)&&r.sslConnection,enumerable:!0},queuing:{value:!1,writable:!0},reconnectionDelay:{value:r&&"number"==typeof r.reconnectionDelay?r.reconnectionDelay:1e3,enumerable:!0},autoReconnect:{value:!r||"boolean"!=typeof r.autoReconnect||r.autoReconnect,enumerable:!0},autoQueue:{value:!1,enumerable:!0,writable:!0},autoReplay:{value:!1,enumerable:!0,writable:!0},state:{value:"offline",enumerable:!0,writable:!0},offlineQueue:{value:[],enumerable:!0,writable:!0},queueFilter:{value:null,enumerable:!0,writable:!0},queueMaxSize:{value:500,enumerable:!0,writable:!0},queueTTL:{value:12e4,enumerable:!0,writable:!0},replayInterval:{value:10,enumerable:!0,writable:!0},offlineQueueLoader:{value:null,enumerable:!0,writable:!0}}),r&&(Object.keys(r).forEach(function(e){o.hasOwnProperty(e)&&Object.getOwnPropertyDescriptor(o,e).writable&&(o[e]=r[e])}),"auto"===r.offlineMode&&o.autoReconnect&&(o.autoQueue=o.autoReplay=!0)),Object.defineProperty(o,"requestHistory",{value:{},writable:!0}),o.wasConnected=!1,o.stopRetryingToConnect=!1,o.retrying=!1,o}return o(t,e),d(t,[{key:"connect",value:function(){this.state="connecting",this.autoQueue&&this.startQueuing()}},{key:"clientConnected",value:function(){var e=this;this.state="connected",this.emit(this.wasConnected&&"reconnect"||"connect"),this.wasConnected=!0,this.stopRetryingToConnect=!1,this.autoQueue&&this.stopQueuing(),this.autoReplay&&this.playQueue(),this.cleanHistoryTimer||(this.cleanHistoryTimer=setInterval(function(){a(e.requestHistory)},1e3))}},{key:"clientDisconnected",value:function(){this.state="offline",this.autoQueue&&this.startQueuing(),this.clearHistoryTimer(),this.emit("disconnect")}},{key:"clientNetworkError",value:function(e){var t=this;this.state="offline",this.autoQueue&&this.startQueuing(),this.clearHistoryTimer(),this.emit("networkError",e),!this.autoReconnect||this.retrying||this.stopRetryingToConnect?this.emit("disconnect"):(this.retrying=!0,
setTimeout(function(){t.retrying=!1,t.connect(t.host)},this.reconnectionDelay))}},{key:"flushQueue",value:function(){this.offlineQueue=[]}},{key:"playQueue",value:function(){"connected"===this.state&&(s(this),c(this))}},{key:"startQueuing",value:function(){this.queuing=!0}},{key:"stopQueuing",value:function(){this.queuing=!1}},{key:"subscribe",value:function(e,t,r,n){var i=this;return"connected"!==this.state?n(new Error("Not Connected")):void this.query(e,t,function(e,t){return e?n(e):(i.on(t.result.channel,function(e){e.fromSelf=void 0!==i.requestHistory[e.requestId],r(e)}),void n(null,t.result))})}},{key:"unsubscribe",value:function(e,t,r){this.removeAllListeners(t),this.query(e,null,function(e,t){r&&r(e,e?void 0:t.result)})}},{key:"query",value:function(e,t,r){var n=t&&t.queuable!==!1||!0;return this.queueFilter&&(n=n&&this.queueFilter(e)),this.queuing&&n?(s(this,e,r),this.emit("offlineQueuePush",{query:e,cb:r}),this.offlineQueue.push({ts:Date.now(),query:e,cb:r})):"connected"===this.state?u(this,e,r):l(e,r)}},{key:"clearHistoryTimer",value:function(){this.cleanHistoryTimer&&(clearInterval(this.cleanHistoryTimer),this.cleanHistoryTimer=null)}}]),t}(p);e.exports=y},function(e,t,r){function n(e,t,r,n){if(i.call(this,e,t,r,n),Object.defineProperties(this,{deleteActionName:{value:"deleteUser"},updateActionName:{value:"updateUser"},credentials:{value:{},writable:!0,enumerable:!0}}),e.kuzzle.bluebird)return e.kuzzle.bluebird.promisifyAll(this,{suffix:"Promise",filter:function(e,t,r,n){var i=["create","replace","saveRestricted","update","getProfiles"];return n&&i.indexOf(e)!==-1}})}var i=r(3);n.prototype=Object.create(i.prototype,{constructor:{value:n}}),n.prototype.setProfiles=function(e){if(!Array.isArray(e)||"string"!=typeof e[0])throw new Error('Parameter "profileIds" must be an array of strings');return this.content.profileIds=e,this},n.prototype.setCredentials=function(e){if("object"!=typeof e)throw new Error('Parameter "credentials" must be a object');return this.credentials=e,this},n.prototype.addProfile=function(e){if("string"!=typeof e)throw new Error('Parameter "profileId" must be a string');return this.content.profileIds||(this.content.profileIds=[]),this.content.profileIds.indexOf(e)===-1&&this.content.profileIds.push(e),this},n.prototype.create=function(e,t){var r=this.creationSerialize(),n=this;if(!this.content.profileIds)throw new Error('Argument "profileIds" is mandatory in a user. This argument contains an array of profile identifiers.');return e&&void 0===t&&"function"==typeof e&&(t=e,e=null),this.kuzzle.query(this.Security.buildQueryArgs("createUser"),r,null,t&&function(e){t(e,e?void 0:n)}),this},n.prototype.replace=function(e,t){var r=this.serialize(),n=this;if(!this.content.profileIds)throw new Error('Argument "profileIds" is mandatory in a user. This argument contains an array of profile identifiers.');return e&&void 0===t&&"function"==typeof e&&(t=e,e=null),this.kuzzle.query(this.Security.buildQueryArgs("replaceUser"),r,null,t&&function(e){t(e,e?void 0:n)}),this},n.prototype.saveRestricted=function(e,t){var r=this.serialize(),n=this;return e&&void 0===t&&"function"==typeof e&&(t=e,e=null),n.kuzzle.query(this.Security.buildQueryArgs("createRestrictedUser"),r,e,t&&function(e){t(e,e?void 0:n)}),n},n.prototype.serialize=function(){return{_id:this.id,body:this.content,meta:this.meta}},n.prototype.creationSerialize=function(){return{_id:this.id,body:{content:this.content,credentials:this.credentials,meta:this.meta}}},n.prototype.getProfileIds=function(){return this.content.profileIds||[]},n.prototype.getProfiles=function(e,t){var r=this,n=[],i=!1;return e&&!t&&"function"==typeof e&&(t=e,e=null),r.Security.kuzzle.callbackRequired("User.getProfiles",t),r.content.profileIds?void r.content.profileIds.forEach(function(o){r.Security.fetchProfile(o,e,function(e,o){if(e){if(i)return;return i=!0,t(e)}n.push(o),n.length===r.content.profileIds.length&&t(null,n)})}):t(null,n)},e.exports=n},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r(1),s=function(e){function t(e,r,o){n(this,t);var u=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),l=null;if(Object.defineProperties(u,{roomstate:{value:"inactive",writable:!0},kuzzle:{value:e.kuzzle},isListening:{value:!1,writable:!0},resubscribe:{value:function(){u.roomstate="inactive",u.error=null,u.subscribe()}},deactivate:{value:function(){u.roomstate="inactive"}},resubscribeConditional:{value:function(){u.roomstate="inactive",u.autoResubscribe&&u.subscribe()}},channel:{value:null,writable:!0,enumerable:!0},scope:{value:o&&o.scope?o.scope:"all",enumerable:!0},state:{value:o&&o.state?o.state:"done",enumerable:!0},users:{value:o&&o.users?o.users:"none",enumerable:!0},collection:{value:e,enumerable:!0},filters:{value:r?r:{},enumerable:!0},roomId:{enumerable:!0,get:function(){return l},set:function(e){l||(l=e)}},volatile:{value:o&&o.volatile?o.volatile:{},enumerable:!0,writable:!0},subscribeToSelf:{value:!o||"boolean"!=typeof o.subscribeToSelf||o.subscribeToSelf,enumerable:!0,writable:!0},autoResubscribe:{value:o&&"boolean"==typeof o.autoResubscribe?o.autoResubscribe:e.kuzzle.autoResubscribe,enumerable:!0}}),u.kuzzle.bluebird){var s;return s=u.kuzzle.bluebird.promisifyAll(u,{suffix:"Promise",filter:function(e,t,r,n){var i=["count","subscribe","unsubscribe","onDone"];return n&&i.indexOf(e)!==-1}}),i(u,s)}return u}return o(t,e),u(t,[{key:"count",value:function(e){this.kuzzle.callbackRequired("Room.count",e);var t={body:{roomId:this.roomId}};return"active"!==this.roomstate?e(new Error("Cannot count subscriptions on an non-active room")):void this.kuzzle.query(this.collection.buildQueryArgs("realtime","count"),t,function(t,r){e(t,r&&r.result.count)})}},{key:"subscribe",value:function(e,t){var r=this;return t||"function"!=typeof e||(t=e,e=null),t&&this.onDone(t),"active"===this.roomstate?(this.emit("done",null,this),this):"subscribing"===this.roomstate?this:(this.error=null,this.roomstate="subscribing",this.kuzzle.subscribe(this,e,function(e,t){return e?"Not Connected"===e.message?r.kuzzle.once("connected",r.resubscribe):(r.roomstate="inactive",r.error=new Error("Error during Kuzzle subscription: "+e.message),r.emit("done",r.error),null):(r.roomId=t.roomId,r.channel=t.channel,r.roomstate="active",r.isListening||(r.kuzzle.addListener("disconnected",r.deactivate),r.kuzzle.addListener("tokenExpired",r.deactivate),r.kuzzle.addListener("reconnected",r.resubscribeConditional),r.isListening=!0),void r.emit("done",null,r))}),this)}},{key:"unsubscribe",value:function(e){return"subscribing"===this.roomstate?(e&&e(new Error("Cannot unsubscribe a room while a subscription attempt is underway")),this):(this.isListening&&(this.kuzzle.removeListener("disconnected",this.deactivate),this.kuzzle.removeListener("tokenExpired",this.deactivate),this.kuzzle.removeListener("reconnected",this.resubscribeConditional),this.isListening=!1),"active"===this.roomstate?this.kuzzle.unsubscribe(this,e):e&&e(null,this.roomId),this.roomstate="inactive",this)}},{key:"notify",value:function(e){if(void 0===e.type)throw new Error("Room.notify: argument must match {type: <document|user>}");return e.fromSelf&&!this.subscribeToSelf||this.emit(e.type,e),this}},{key:"onDone",value:function(e){if(!e||"function"!=typeof e)throw new Error("Room.onDone: a callback argument is required.");return this.error?e(this.error):"active"===this.roomstate?e(null,this):this.once("done",e),this}}]),t}(l);e.exports=s},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(2),u=function(){function e(t,r,i,u){if(n(this,e),Object.defineProperties(this,{collection:{value:t,enumerable:!0},total:{value:u.result.total,enumerable:!0},documents:{value:u.result.hits.map(function(e){var r=new o(t,e._id,e._source,e._meta);return r.version=e._version,r}),enumerable:!0},aggregations:{value:u.result.aggregations||{},enumerable:!0},options:{value:{from:i.from,size:i.size,scrollId:u.result._scroll_id},enumerable:!0},filters:{value:r||{},enumerable:!0},fetched:{value:u.result.hits.length,enumerable:!0,writable:!0}}),Object.freeze(this.filters),Object.freeze(this.options),Object.freeze(this.aggregations),this.collection.kuzzle.bluebird){var l=["fetchNext"];return this.collection.kuzzle.bluebird.promisifyAll(this,{suffix:"Promise",filter:function(e,t,r,n){return n&&l.includes(e)}})}return this}return i(e,[{key:"fetchNext",value:function(e){var t=this,r=function(r,n){return r?e(r):(n.fetched+=t.fetched,void e(null,n))};if(this.collection.kuzzle.callbackRequired("SearchResult.fetchNext",e),this.fetched>=this.total)return e(null,null);if(this.options.scrollId)return void this.collection.scroll(this.options.scrollId,null,this.filters||{},r);if(void 0!==this.options.size&&this.filters.sort){var n=Object.assign({},this.filters,{search_after:[]}),i=!0,o=!1,u=void 0;try{for(var l,s=n.sort[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var c=l.value;n.search_after.push(this.documents[this.documents.length-1].content[Object.keys(c)[0]])}}catch(e){o=!0,u=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw u}}return void this.collection.search(n,{size:this.options.size},r)}if(void 0!==this.options.from&&void 0!==this.options.size){var a={from:this.options.from+this.options.size,size:this.options.size};return a.from>=this.total?e(null,null):void this.collection.search(this.filters,a,r)}e(new Error("Unable to retrieve next results from search: missing scrollId or from/size params"))}}]),e}();e.exports=u},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var u=i.get;if(void 0!==u)return u.call(n)},s=r(4),c=function(e){function t(e,r){n(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return o.socket=null,o.forceDisconnect=!1,o.eventsWrapper={},o}return o(t,e),u(t,[{key:"connect",value:function(){var e=this;l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"connect",this).call(this),this.socket=window.io((this.ssl?"https://":"http://")+this.host+":"+this.port,{reconnection:this.autoReconnect,reconnectionDelay:this.reconnectionDelay,forceNew:!0}),this.socket.on("connect",function(){return e.clientConnected()}),this.socket.on("connect_error",function(t){return e.clientNetworkError(t)}),this.socket.on("disconnect",function(){if(e.forceDisconnect)e.clientDisconnected();else{var t=new Error("An error occurred, kuzzle may not be ready yet");t.status=500,e.clientNetworkError(t)}e.forceDisconnect=!1})}},{key:"addListener",value:function(e,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._addEventWrapper(e,r,n),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addListener",this).call(this,e,r,n),this}},{key:"prependListener",value:function(e,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._addEventWrapper(e,r,n),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"prependListener",this).call(this,e,r,n)}},{key:"removeListener",value:function(e,r){return this.eventsWrapper[e]&&(this.eventsWrapper[e].listeners.delete(r),0===this.eventsWrapper[e].listeners.size&&(this.socket.off(e,this.eventsWrapper[e].wrapper),delete this.eventsWrapper[e]),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"removeListener",this).call(this,e,r)),this}},{key:"removeAllListeners",value:function(e){if(void 0!==e){if(void 0!==this.eventsWrapper[e]){var t=!0,r=!1,n=void 0;try{for(var i,o=this.eventsWrapper[e].listeners[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var u=i.value;this.removeListener(e,u)}}catch(e){r=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(r)throw n}}}}else{var l=!0,s=!1,c=void 0;try{for(var a,f=Object.keys(this.eventsWrapper)[Symbol.iterator]();!(l=(a=f.next()).done);l=!0){var d=a.value;this.removeAllListeners(d)}}catch(e){s=!0,c=e}finally{try{!l&&f.return&&f.return()}finally{if(s)throw c}}}return this}},{key:"send",value:function(e){this.socket.emit("kuzzle",e)}},{key:"close",value:function(){this.forceDisconnect=!0,this.state="offline",this.socket.close(),this.socket=null}},{key:"_addEventWrapper",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.eventsWrapper[e]){var i=function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return r.emit.apply(r,[e].concat(n))};this.eventsWrapper[e]={wrapper:i,listeners:new Set},["connect","connect_error","disconnect"].indexOf(e)===-1&&(n?this.socket.once(e,i):this.socket.on(e,i))}this.eventsWrapper[e].listeners.add(t)}}]),t}(s);e.exports=c},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var u=i.get;if(void 0!==u)return u.call(n)},s=r(4),c=void 0,a=function(e){function t(e,o){n(this,t);var u=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o));return c="undefined"!=typeof WebSocket?WebSocket:r(!function(){var e=new Error('Cannot find module "ws"');throw e.code="MODULE_NOT_FOUND",e}()),u.client=null,u.lasturl=null,u}return o(t,e),u(t,[{key:"connect",value:function(){var e=this,r=(this.ssl?"wss://":"ws://")+this.host+":"+this.port,n="undefined"!=typeof window?void 0:{perMessageDeflate:!1};l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"connect",this).call(this),r!==this.lasturl&&(this.wasConnected=!1,this.lasturl=r),this.client=new c(r,n),this.client.onopen=function(){e.clientConnected()},this.client.onclose=function(t,r){var n=void 0,i=r;if("number"==typeof t?n=t:(n=t.code,t.reason&&(i=t.reason)),1e3===n)e.clientDisconnected();else if(e.wasConnected){var o=new Error(i);o.status=n,e.clientNetworkError(o)}},this.client.onerror=function(t){var r=t instanceof Error&&t||new Error(t);e.clientNetworkError(r)},this.client.onmessage=function(t){var r=JSON.parse(t.data||t);r.room?e.emit(r.room,r):e.emit("discarded",r)}}},{key:"send",value:function(e){this.client&&this.client.readyState===this.client.OPEN&&this.client.send(JSON.stringify(e))}},{key:"close",value:function(){this.state="offline",this.removeAllListeners(),this.wasConnected=!1,this.client&&this.client.close(),this.client=null,this.stopRetryingToConnect=!0}}]),t}(s);e.exports=a},function(e,t,r){function n(e,t,r){if(!r||!t)throw new Error("The Collection object constructor needs an index and a collection arguments");return Object.defineProperties(this,{collection:{value:t,enumerable:!0},index:{value:r,enumerable:!0},kuzzle:{value:e,enumerable:!0}}),Object.defineProperty(this,"buildQueryArgs",{value:function(e,t){return{controller:e,action:t,collection:this.collection,index:this.index}}}),this.kuzzle.bluebird?this.kuzzle.bluebird.promisifyAll(this,{suffix:"Promise",filter:function(e,t,r,n){var i=["subscribe"];return n&&i.indexOf(e)===-1}}):this}var i=r(7),o=r(2),u=r(11),l=r(6);n.prototype.count=function(e,t,r){var n={body:e};r||"function"!=typeof t||(r=t,t=null),this.kuzzle.callbackRequired("Collection.count",r),this.kuzzle.query(this.buildQueryArgs("document","count"),n,t,function(e,t){r(e,e?void 0:t.result.count)})},n.prototype.create=function(e,t){var r={},n=this;return t||"function"!=typeof e||(t=e,e=null),this.kuzzle.query(this.buildQueryArgs("collection","create"),r,e,function(e){t(e,e?void 0:n)}),this},n.prototype.createDocument=function(e,t,r,n){var i=this,u={},l="create";if(e&&"string"!=typeof e&&(n=r,r=t,t=e,e=null),n||"function"!=typeof r||(n=r,r=null),t instanceof o?u=t.serialize():u.body=t,r&&r.ifExist)if("replace"===r.ifExist)l="createOrReplace";else if("error"!==r.ifExist)throw new Error('Invalid value for the "ifExist" option: '+r.ifExist);return e&&(u._id=e),i.kuzzle.query(this.buildQueryArgs("document",l),u,r,n&&function(e,t){var r;return e?n(e):(r=new o(i,t.result._id,t.result._source,t.result._meta),r.version=t.result._version,void n(null,r))}),this},n.prototype.deleteDocument=function(e,t,r){var n,i={};return"string"==typeof e?(i._id=e,n="delete"):(i.body={query:e},n="deleteByQuery"),r||"function"!=typeof t||(r=t,t=null),this.kuzzle.query(this.buildQueryArgs("document",n),i,t,r&&function(e,t){e?r(e):r(null,"delete"===n?[t.result._id]:t.result.ids)}),this},n.prototype.deleteSpecifications=function(e,t){var r={index:this.index,collection:this.collection},n=this;return t||"function"!=typeof e||(t=e,e=null),n.kuzzle.query(this.buildQueryArgs("collection","deleteSpecifications"),r,e,function(e,r){t(e,e?void 0:r.result)}),n},n.prototype.documentExists=function(e,t,r){var n={_id:e},i=this;r||"function"!=typeof t||(r=t,t=null),i.kuzzle.callbackRequired("Collection.documentExists",r),i.kuzzle.query(this.buildQueryArgs("document","exists"),n,t,function(e,t){r(e,e?void 0:t.result)})},n.prototype.fetchDocument=function(e,t,r){var n={_id:e},i=this;r||"function"!=typeof t||(r=t,t=null),i.kuzzle.callbackRequired("Collection.fetch",r),i.kuzzle.query(this.buildQueryArgs("document","get"),n,t,function(e,t){var n;return e?r(e):(n=new o(i,t.result._id,t.result._source,t.result._meta),n.version=t.result._version,void r(null,n))})},n.prototype.getMapping=function(e,t){var r;t||"function"!=typeof e||(t=e,e=null),this.kuzzle.callbackRequired("Collection.getMapping",t),r=new u(this),r.refresh(e,t)},n.prototype.mCreateDocument=function(e,t,r){var n={body:{}},i=this;return r||"function"!=typeof t||(r=t,t=null),Array.isArray(e)?(i.kuzzle.callbackRequired("Collection.mCreate",r),n.body.documents=e.map(function(e){return e instanceof o?e.serialize():e}),i.kuzzle.query(this.buildQueryArgs("document","mCreate"),n,t,r&&function(e,t){r(e,t&&t.result)}),i):r(new Error("Collection.mCreateDocument: documents parameter format is invalid (should be an array of documents)"))},n.prototype.mCreateOrReplaceDocument=function(e,t,r){var n={body:{}},i=this;return r||"function"!=typeof t||(r=t,t=null),Array.isArray(e)?(i.kuzzle.callbackRequired("Collection.mCreateOrReplace",r),n.body.documents=e.map(function(e){return e instanceof o?e.serialize():e}),i.kuzzle.query(this.buildQueryArgs("document","mCreateOrReplace"),n,t,r&&function(e,t){r(e,t&&t.result)}),i):r(new Error("Collection.mCreateOrReplaceDocument: documents parameter format is invalid (should be an array of documents)"))},n.prototype.mDeleteDocument=function(e,t,r){var n={body:{ids:e}},i=this;return r||"function"!=typeof t||(r=t,t=null),Array.isArray(e)?(i.kuzzle.callbackRequired("Collection.mDelete",r),i.kuzzle.query(this.buildQueryArgs("document","mDelete"),n,t,r&&function(e,t){r(e,t&&t.result)}),i):r(new Error("Collection.mDeleteDocument: documentIds parameter format is invalid (should be an array of IDs)"))},n.prototype.mGetDocument=function(e,t,r){var n={body:{ids:e}},i=this;return r||"function"!=typeof t||(r=t,t=null),Array.isArray(e)?(i.kuzzle.callbackRequired("Collection.mGet",r),void i.kuzzle.query(this.buildQueryArgs("document","mGet"),n,t,r&&function(e,t){r(e,e?void 0:t.result)})):r(new Error("Collection.mGetDocument: documentIds parameter format is invalid (should be an array of IDs)"))},n.prototype.mReplaceDocument=function(e,t,r){var n={body:{}},i=this;return r||"function"!=typeof t||(r=t,t=null),Array.isArray(e)?(i.kuzzle.callbackRequired("Collection.mReplace",r),n.body.documents=e.map(function(e){return e instanceof o?e.serialize():e}),i.kuzzle.query(this.buildQueryArgs("document","mReplace"),n,t,r&&function(e,t){r(e,e?void 0:t.result)}),i):r(new Error("Collection.mReplaceDocument: documents parameter format is invalid (should be an array of documents)"))},n.prototype.mUpdateDocument=function(e,t,r){var n={body:{}},i=this;return r||"function"!=typeof t||(r=t,t=null),Array.isArray(e)?(i.kuzzle.callbackRequired("Collection.mUpdate",r),n.body.documents=e.map(function(e){return e instanceof o?e.serialize():e}),i.kuzzle.query(this.buildQueryArgs("document","mUpdate"),n,t,r&&function(e,t){r(e,t&&t.result)}),i):r(new Error("Collection.mUpdateDocument: documents parameter format is invalid (should be an array of documents)"))},n.prototype.getSpecifications=function(e,t){var r={index:this.index,collection:this.collection},n=this;t||"function"!=typeof e||(t=e,e=null),n.kuzzle.callbackRequired("Collection.getSpecifications",t),n.kuzzle.query(this.buildQueryArgs("collection","getSpecifications"),r,e,function(e,r){t(e,e?void 0:r.result)})},n.prototype.publishMessage=function(e,t,r){var n={};return e instanceof o?n=e.serialize():n.body=e,this.kuzzle.query(this.buildQueryArgs("realtime","publish"),n,t,r),this},n.prototype.replaceDocument=function(e,t,r,n){var i=this,u={_id:e,body:t};return n||"function"!=typeof r||(n=r,r=null),i.kuzzle.query(this.buildQueryArgs("document","createOrReplace"),u,r,n&&function(e,t){var r;return e?n(e):(r=new o(i,t.result._id,t.result._source,t.result._meta),r.version=t.result._version,void n(null,r))}),this},n.prototype.search=function(e,t,r){var n={body:e},o=this;r||"function"!=typeof t||(r=t,t={}),o.kuzzle.callbackRequired("Collection.search",r),o.kuzzle.query(o.buildQueryArgs("document","search"),n,t,function(n,u){return n?r(n):void r(null,new i(o,e,t,u))})},n.prototype.scroll=function(e,t,r,n){var o={},u=this;if(!e)throw new Error("Collection.scroll: scrollId is required");n||(n=r,r=null),n||"function"!=typeof t||(n=t,t={}),this.kuzzle.callbackRequired("Collection.scroll",n),o.scrollId=e,this.kuzzle.query({controller:"document",action:"scroll"},o,t,function(e,o){return e?n(e):void n(null,new i(u,r,t,o))})},n.prototype.scrollSpecifications=function(e,t,r){var n={scrollId:e};if(!e)throw new Error("Collection.scrollSpecifications: scrollId is required");r||"function"!=typeof t||(r=t,t={}),this.kuzzle.callbackRequired("Collection.scrollSpecifications",r),this.kuzzle.query({controller:"collection",action:"scrollSpecifications"},n,t,function(e,t){r(e,e?void 0:t.result)})},n.prototype.searchSpecifications=function(e,t,r){var n={body:{query:e}},i=this;r||"function"!=typeof t||(r=t,t={}),i.kuzzle.callbackRequired("Collection.searchSpecifications",r),i.kuzzle.query({controller:"collection",action:"searchSpecifications"},n,t,function(e,t){r(e,e?void 0:t.result)})},n.prototype.room=function(e,t){return new l(this,e,t)},n.prototype.subscribe=function(e,t,r){var n,i;return r||"function"!=typeof t||(r=t,t=null),this.kuzzle.callbackRequired("Collection.subscribe",r),n=t&&t.users&&"none"!==t.users?"user":"document",i=new l(this,e,t),i.subscribe().on(n,r),i},n.prototype.truncate=function(e,t){var r={};return t||"function"!=typeof e||(t=e,e=null),this.kuzzle.query(this.buildQueryArgs("collection","truncate"),r,e,t),this},n.prototype.updateDocument=function(e,t,r,n){var i={_id:e,body:t},u=this;return n||"function"!=typeof r||(n=r,r=null),r&&r.retryOnConflict&&(i.retryOnConflict=r.retryOnConflict),u.kuzzle.query(this.buildQueryArgs("document","update"),i,r,n&&function(e,t){return e?n(e):void new o(u,t.result._id).refresh(n)}),u},n.prototype.updateSpecifications=function(e,t,r){var n={},i={body:{}},o=this;return n[this.collection]=e,i.body[this.index]=n,r||"function"!=typeof t||(r=t,t=null),o.kuzzle.query(this.buildQueryArgs("collection","updateSpecifications"),i,t,r&&function(e,t){r(e,e?void 0:t.result)}),o},n.prototype.validateSpecifications=function(e,t,r){var n={},i={body:{}},o=this;n[this.collection]=e,i.body[this.index]=n,r||"function"!=typeof t||(r=t,t=null),o.kuzzle.callbackRequired("Collection.validateSpecifications",r),o.kuzzle.query(this.buildQueryArgs("collection","validateSpecifications"),i,t,function(e,t){r(e,e?void 0:t.result.valid)})},n.prototype.document=function(e,t){return new o(this,e,t)},n.prototype.collectionMapping=function(e){return new u(this,e)},e.exports=n},function(e,t){function r(e,t){return Object.defineProperties(this,{collection:{value:e,enumerable:!0},kuzzle:{value:e.kuzzle,enumerable:!0},mapping:{value:t||{},enumerable:!0,writable:!0}}),this.kuzzle.bluebird?this.kuzzle.bluebird.promisifyAll(this,{suffix:"Promise",filter:function(e,t,r,n){var i=["set"];return n&&i.indexOf(e)===-1}}):this}r.prototype.apply=function(e,t){var r=this,n={body:{properties:this.mapping}};return t||"function"!=typeof e||(t=e,e=null),r.kuzzle.query(this.collection.buildQueryArgs("collection","updateMapping"),n,e,function(n){return n?t&&t(n):void r.refresh(e,t)}),this},r.prototype.refresh=function(e,t){var r=this,n={};return t||"function"!=typeof e||(t=e,e=null),this.kuzzle.query(this.collection.buildQueryArgs("collection","getMapping"),n,e,function(e,n){return e?!!t&&t(e):n.result[r.collection.index]?n.result[r.collection.index].mappings[r.collection.collection]?(r.mapping=n.result[r.collection.index].mappings[r.collection.collection].properties,void 0===r.mapping&&(r.mapping={}),void(t&&t(null,r))):t&&t(new Error("No mapping found for collection "+r.collection.collection)):t&&t(new Error("No mapping found for index "+r.collection.index))}),this},r.prototype.set=function(e,t){return this.mapping[e]=t,this},e.exports=r},function(e,t){function r(e){return Object.defineProperties(this,{kuzzle:{value:e,enumerable:!0}}),this.kuzzle.bluebird?this.kuzzle.bluebird.promisifyAll(this,{suffix:"Promise",filter:function(e,t,r,n){var i=[];return n&&i.indexOf(e)===-1}}):this}function n(e,t,r,n){t||"_id"===r?e[r]=n:e.body[r]=n}function i(e,t){var r=[];Object.keys(t).filter(function(e){return t[e]&&["withcoord","withdist","count","sort"].indexOf(e)!==-1}).forEach(function(e){"withcoord"===e||"withdist"===e?(r.push(e),delete t[e]):"count"!==e&&"sort"!==e||("count"===e&&r.push("count"),r.push(t[e])),delete t[e]}),r.length>0&&(e.options=r)}function o(e,t){e.options=["withscores"],t.limit&&(e.limit=t.limit,delete t.limit)}function u(e){return e.map(function(e){return e.map(function(e){return parseFloat(e)})})}function l(e){return Array.isArray(e[0])?e.map(function(e){var t,r={name:e[0]};for(t=1;t<e.length;t++)Array.isArray(e[t])?r.coordinates=e[t].map(function(e){return parseFloat(e)}):r.distance=parseFloat(e[t]);return r}):e.map(function(e){return{name:e}})}function s(e){return Array.isArray(e)?e:[e]}function c(e){return e.map(function(e){return parseInt(e)})}function a(){}function f(e){var t=null,r=[];return e.forEach(function(e){null===t?t=e:(r.push({member:t,score:parseFloat(e)}),t=null)}),r}function d(e){return{cursor:e[0],values:e[1]}}var p={getter:!0,required:["_id"]},y={getter:!0,required:["_id","field"]},h={getter:!0,required:["keys"]},v={getter:!0,required:["_id","member"]},b={getter:!0,required:["_id","cursor"],opts:["match","count"],mapResults:d},m={getter:!0,required:["_id","start","stop"],opts:o,mapResults:f},g={getter:!0,required:["_id","min","max"],opts:o,mapResults:f},w={required:["_id"]},k={required:["_id","value"]},z={append:k,bitcount:{getter:!0,required:["_id"],opts:["start","end"]},bitop:{required:["_id","operation","keys"]},bitpos:{getter:!0,required:["_id","bit"],opts:["start","end"]},dbsize:{getter:!0},decr:w,decrby:k,del:{required:["keys"]},exists:h,expire:{required:["_id","seconds"],mapResults:Boolean},expireat:{required:["_id","timestamp"],mapResults:Boolean},flushdb:{mapResults:a},geoadd:{required:["_id","points"]},geodist:{getter:!0,required:["_id","member1","member2"],opts:["unit"],mapResults:parseFloat},geohash:{getter:!0,required:["_id","members"]},geopos:{getter:!0,required:["_id","members"],mapResults:u},georadius:{getter:!0,required:["_id","lon","lat","distance","unit"],opts:i,mapResults:l},georadiusbymember:{getter:!0,required:["_id","member","distance","unit"],opts:i,mapResults:l},get:p,getbit:{getter:!0,required:["_id","offset"]},getrange:{getter:!0,required:["_id","start","end"]},getset:k,hdel:{required:["_id","fields"]},hexists:{getter:!0,required:["_id","field"],mapResults:Boolean},hget:y,hgetall:{getter:!0,required:["_id"]},hincrby:{required:["_id","field","value"]},hincrbyfloat:{required:["_id","field","value"],mapResults:parseFloat},hkeys:p,hlen:p,hmget:{getter:!0,required:["_id","fields"]},hmset:{required:["_id","entries"],mapResults:a},hscan:b,hset:{required:["_id","field","value"],mapResults:Boolean},hsetnx:{required:["_id","field","value"],mapResults:Boolean},hstrlen:y,hvals:p,incr:w,incrby:k,incrbyfloat:{required:["_id","value"],mapResults:parseFloat},keys:{getter:!0,required:["pattern"]},lindex:{getter:!0,required:["_id","idx"]},linsert:{required:["_id","position","pivot","value"]},llen:p,lpop:w,lpush:{required:["_id","values"]},lpushx:k,lrange:{getter:!0,required:["_id","start","stop"]},lrem:{required:["_id","count","value"]},lset:{required:["_id","index","value"],mapResults:a},ltrim:{required:["_id","start","stop"],mapResults:a},mget:h,mset:{required:["entries"],mapResults:a},msetnx:{required:["entries"],mapResults:Boolean},object:{getter:!0,required:["_id","subcommand"]},persist:{required:["_id"],mapResults:Boolean},pexpire:{required:["_id","milliseconds"],mapResults:Boolean},pexpireat:{required:["_id","timestamp"],mapResults:Boolean},pfadd:{required:["_id","elements"],mapResults:Boolean},pfcount:h,pfmerge:{required:["_id","sources"],mapResults:a},ping:{getter:!0},psetex:{required:["_id","value","milliseconds"],mapResults:a},pttl:p,randomkey:{getter:!0},rename:{required:["_id","newkey"],mapResults:a},renamenx:{required:["_id","newkey"],mapResults:Boolean},rpop:w,rpoplpush:{
required:["source","destination"]},rpush:{required:["_id","values"]},rpushx:k,sadd:{required:["_id","members"]},scan:{getter:!0,required:["cursor"],opts:["match","count"],mapResults:d},scard:p,sdiff:{getter:!0,required:["_id","keys"]},sdiffstore:{required:["_id","keys","destination"]},set:{required:["_id","value"],opts:["ex","px","nx","xx"],mapResults:a},setex:{required:["_id","value","seconds"],mapResults:a},setnx:{required:["_id","value"],mapResults:Boolean},sinter:h,sinterstore:{required:["destination","keys"]},sismember:{getter:!0,required:["_id","member"],mapResults:Boolean},smembers:p,smove:{required:["_id","destination","member"],mapResults:Boolean},sort:{getter:!0,required:["_id"],opts:["alpha","by","direction","get","limit"]},spop:{required:["_id"],opts:["count"],mapResults:s},srandmember:{getter:!0,required:["_id"],opts:["count"],mapResults:s},srem:{required:["_id","members"]},sscan:b,strlen:p,sunion:h,sunionstore:{required:["destination","keys"]},time:{getter:!0,mapResults:c},touch:{required:["keys"]},ttl:p,type:p,zadd:{required:["_id","elements"],opts:["nx","xx","ch","incr"]},zcard:p,zcount:{getter:!0,required:["_id","min","max"]},zincrby:{required:["_id","member","value"]},zinterstore:{required:["_id","keys"],opts:["weights","aggregate"]},zlexcount:{getter:!0,required:["_id","min","max"]},zrange:m,zrangebylex:{getter:!0,required:["_id","min","max"],opts:["limit"]},zrevrangebylex:{getter:!0,required:["_id","min","max"],opts:["limit"]},zrangebyscore:g,zrank:v,zrem:{required:["_id","members"]},zremrangebylex:{required:["_id","min","max"]},zremrangebyrank:{required:["_id","start","stop"]},zremrangebyscore:{required:["_id","min","max"]},zrevrange:m,zrevrangebyscore:g,zrevrank:v,zscan:b,zscore:{getter:!0,required:["_id","member"],mapResults:parseFloat},zunionstore:{required:["_id","keys"],opts:["weights","aggregate"]}};!function(){Object.keys(z).forEach(function(e){r.prototype[e]=function(){var t,r=Array.prototype.slice.call(arguments),i=null,o={controller:"ms",action:e},u={};if(r.length&&"function"==typeof r[r.length-1]&&(t=r.pop()),z[e].getter&&this.kuzzle.callbackRequired("MemoryStorage."+e,t),z[e].getter||(u.body={}),z[e].required&&z[e].required.forEach(function(t){var i=r.shift();if(void 0===i)throw new Error("MemoryStorage."+e+': Missing parameter "'+t+'"');n(u,z[e].getter,t,i)}),r.length>1)throw new Error("MemoryStorage."+e+": Too many parameters provided");if(1===r.length&&"object"!=typeof r[0]||Array.isArray(r[0]))throw new Error("MemoryStorage."+e+": Invalid optional parameter (expected an object)");if(r.length&&(i=Object.assign({},r[0]),Array.isArray(z[e].opts)&&z[e].opts.forEach(function(t){null!==i[t]&&void 0!==i[t]&&(n(u,z[e].getter,t,i[t]),delete i[t])})),"function"==typeof z[e].opts&&z[e].opts(u,i||{}),this.kuzzle.query(o,u,i,t&&function(r,n){return r?t(r):z[e].mapResults?t(null,z[e].mapResults(n.result)):void t(null,n.result)}),!z[e].getter)return this}})}(),e.exports=r},function(e,t,r){function n(e,t,n){switch(e){case"websocket":if("undefined"!=typeof window&&"undefined"==typeof WebSocket)throw new Error("Aborting: no websocket support detected.");return new(r(9))(t,n);case"socketio":if(!window.io)throw new Error("Aborting: no socket.io library loaded.");return new(r(8))(t,n);default:throw new Error('Aborting: unknown protocol "'+e+'" (only "websocket" and "socketio" are available).')}}e.exports=n},function(e,t,r){function n(e,t,r,n){if(i.call(this,e,t,r,n),Object.defineProperties(this,{deleteActionName:{value:"deleteProfile"},updateActionName:{value:"updateProfile"}}),e.kuzzle.bluebird)return e.kuzzle.bluebird.promisifyAll(this,{suffix:"Promise",filter:function(e,t,r,n){var i=["hydrate","save"];return n&&i.indexOf(e)!==-1}})}var i=r(3);n.prototype=Object.create(i.prototype,{constructor:{value:n}}),n.prototype.save=function(e,t){var r,n=this;if(!this.content.policies)throw new Error('Argument "policies" is mandatory in a profile. This argument contains an array of objects.');return e&&void 0===t&&"function"==typeof e&&(t=e,e=null),r=this.serialize(),n.kuzzle.query(n.Security.buildQueryArgs("createOrReplaceProfile"),r,e,t&&function(e){t(e,e?void 0:n)}),n},n.prototype.addPolicy=function(e){if("object"!=typeof e||"string"!=typeof e.roleId)throw new Error('Parameter "policies" must be an object containing at least a "roleId" member which must be a string.');return this.content.policies||(this.content.policies=[]),this.content.policies.push(e),this},n.prototype.setPolicies=function(e){if(!Array.isArray(e))throw new Error('Parameter "policies" must be an array of objects containing at least a "roleId" member which must be a string');return e.map(function(e){if("object"!=typeof e||"string"!=typeof e.roleId)throw new Error('Parameter "policies" must be an array of objects containing at least a "roleId" member which must be a string')}),this.content.policies=e,this},n.prototype.serialize=function(){var e={};return this.id&&(e._id=this.id),e.body=this.content,e.meta=this.meta,e},n.prototype.getPolicies=function(){return this.content.policies},e.exports=n},function(e,t,r){function n(e,t,r,n){if(i.call(this,e,t,r,n),Object.defineProperties(this,{deleteActionName:{value:"deleteRole"},updateActionName:{value:"updateRole"}}),e.kuzzle.bluebird)return e.kuzzle.bluebird.promisifyAll(this,{suffix:"Promise",filter:function(e,t,r,n){var i=["save"];return n&&i.indexOf(e)!==-1}})}var i=r(3);n.prototype=Object.create(i.prototype,{constructor:{value:n}}),n.prototype.save=function(e,t){var r=this.serialize(),n=this;return e&&void 0===t&&"function"==typeof e&&(t=e,e=null),n.kuzzle.query(this.Security.buildQueryArgs("createOrReplaceRole"),r,e,t&&function(e){t(e,e?void 0:n)}),this},e.exports=n},function(e,t,r){function n(e){return Object.defineProperty(this,"kuzzle",{value:e}),Object.defineProperty(this,"buildQueryArgs",{value:function(e){return{controller:"security",action:e}}}),this.kuzzle.bluebird?this.kuzzle.bluebird.promisifyAll(this,{suffix:"Promise",filter:function(e,t,r,n){var i=["role","profile","user","isActionAllowed"];return n&&i.indexOf(e)===-1}}):this}var i=r(15),o=r(14),u=r(5);n.prototype.fetchRole=function(e,t,r){var n,o=this;if(!e)throw new Error("Id parameter is mandatory for fetchRole function");r||"function"!=typeof t||(r=t,t=null),n={_id:e},o.kuzzle.callbackRequired("Security.fetchRole",r),o.kuzzle.query(this.buildQueryArgs("getRole"),n,t,function(e,t){r(e,e?void 0:new i(o,t.result._id,t.result._source,t.result._meta))})},n.prototype.searchRoles=function(e,t,r){var n=this;r||"function"!=typeof t||(r=t,t=null),n.kuzzle.callbackRequired("Security.searchRoles",r),n.kuzzle.query(this.buildQueryArgs("searchRoles"),{body:e},t,function(e,t){var o;return e?r(e):(o=t.result.hits.map(function(e){return new i(n,e._id,e._source,e._meta)}),void r(null,{total:t.result.total,roles:o}))})},n.prototype.createRole=function(e,t,r,n){var o=this,u={},l="createRole";if(!e||"string"!=typeof e)throw new Error("Security.createRole: cannot create a role without a role ID");n||"function"!=typeof r||(n=r,r=null),u._id=e,u.body=t,r&&(l=r.replaceIfExist?"createOrReplaceRole":"createRole"),o.kuzzle.query(this.buildQueryArgs(l),u,r,n&&function(e,t){n(e,e?void 0:new i(o,t.result._id,t.result._source,t.result._meta))})},n.prototype.updateRole=function(e,t,r,n){var o=this,u={_id:e,body:t},l="updateRole";if(!e||"string"!=typeof e)throw new Error("Security.updateRole: cannot update a role without a role ID");return n||"function"!=typeof r||(n=r,r=null),o.kuzzle.query(this.buildQueryArgs(l),u,r,n&&function(r,u){n(r,r?void 0:new i(o,e,t,u.result._meta))}),this},n.prototype.deleteRole=function(e,t,r){var n={_id:e};return r||"function"!=typeof t||(r=t,t=null),this.kuzzle.query(this.buildQueryArgs("deleteRole"),n,t,r&&function(e,t){r(e,e?void 0:t.result._id)}),this},n.prototype.role=function(e,t,r){return new i(this,e,t,r)},n.prototype.fetchProfile=function(e,t,r){var n,i=this;if(r||"function"!=typeof t||(r=t,t=null),!e||"string"!=typeof e)throw new Error("Id parameter is mandatory for fetchProfile function");n={_id:e},i.kuzzle.callbackRequired("Security.fetchProfile",r),i.kuzzle.query(this.buildQueryArgs("getProfile"),n,t,function(e,t){r(e,e?void 0:new o(i,t.result._id,t.result._source,t.result._meta))})},n.prototype.searchProfiles=function(e,t,r){var n=this;r||"function"!=typeof t||(r=t,t=null),n.kuzzle.callbackRequired("Security.searchProfiles",r),n.kuzzle.query(this.buildQueryArgs("searchProfiles"),{body:e},t,function(e,t){var i,u;return e?r(e):(i=t.result.hits.map(function(e){return new o(n,e._id,e._source,e._meta)}),t.result.scrollId&&(u=t.result.scrollId),void r(null,{total:t.result.total,profiles:i,scrollId:u}))})},n.prototype.createProfile=function(e,t,r,n){var i=this,u={},l="createProfile";if(!e||"string"!=typeof e)throw new Error("Security.createProfile: cannot create a profile without a profile ID");n||"function"!=typeof r||(n=r,r=null),u._id=e,t&&(u.body={policies:t}),r&&(l=r.replaceIfExist?"createOrReplaceProfile":"createProfile"),i.kuzzle.query(this.buildQueryArgs(l),u,r,n&&function(e,t){n(e,e?void 0:new o(i,t.result._id,t.result._source,t.result._meta))})},n.prototype.updateProfile=function(e,t,r,n){var i=this,u={},l="updateProfile";if(!e||"string"!=typeof e)throw new Error("Security.updateProfile: cannot update a profile without a profile ID");return n||"function"!=typeof r||(n=r,r=null),u._id=e,t&&(u.body={policies:t}),i.kuzzle.query(this.buildQueryArgs(l),u,r,n&&function(e,t){var r={};return e?n(e):(Object.keys(t.result._source).forEach(function(e){r[e]=t.result._source[e]}),void n(null,new o(i,t.result._id,r,t.result._meta)))}),this},n.prototype.deleteProfile=function(e,t,r){var n={_id:e};return r||"function"!=typeof t||(r=t,t=null),this.kuzzle.query(this.buildQueryArgs("deleteProfile"),n,t,r&&function(e,t){r(e,e?void 0:t.result._id)}),this},n.prototype.scrollProfiles=function(e,t,r){var n={},i=this;if(!e)throw new Error("Security.scrollProfiles: scrollId is required");r||"function"!=typeof t||(r=t,t={}),this.kuzzle.callbackRequired("Security.scrollProfiles",r),n.scrollId=e,t&&t.scroll&&(n.scroll=t.scroll),this.kuzzle.query({controller:"security",action:"scrollProfiles"},n,t,function(t,n){var u=[];return t?r(t):(n.result.hits.forEach(function(e){var t=new o(i,e._id,e._source,e._meta);t.version=e._version,u.push(t)}),void r(null,{total:n.result.total,profiles:u,scrollId:e}))})},n.prototype.profile=function(e,t,r){return new o(this,e,t,r)},n.prototype.fetchUser=function(e,t,r){var n={_id:e},i=this;if(!e||"string"!=typeof e)throw new Error("Id parameter is mandatory for fetchUser function");r||"function"!=typeof t||(r=t,t=null),i.kuzzle.callbackRequired("Security.fetchUser",r),i.kuzzle.query(this.buildQueryArgs("getUser"),n,t,function(e,t){r(e,e?void 0:new u(i,t.result._id,t.result._source,t.result._meta))})},n.prototype.searchUsers=function(e,t,r){var n=this;r||"function"!=typeof t||(r=t,t=null),n.kuzzle.callbackRequired("Security.searchUsers",r),n.kuzzle.query(this.buildQueryArgs("searchUsers"),{body:e},t,function(e,t){var i,o=null;return e?r(e):(i=t.result.hits.map(function(e){return new u(n,e._id,e._source,e._meta)}),t.result.scrollId&&(o=t.result.scrollId),void r(null,{total:t.result.total,users:i,scrollId:o}))})},n.prototype.createUser=function(e,t,r,n){var i=this,o={_id:e,body:t};n||"function"!=typeof r||(n=r,r=null),i.kuzzle.query(i.buildQueryArgs("createUser"),o,null,n&&function(e,t){n(e,e?void 0:new u(i,t.result._id,t.result._source,t.result._meta))})},n.prototype.replaceUser=function(e,t,r,n){var i=this,o={_id:e,body:t};if(!e||"string"!=typeof e)throw new Error("Security.replaceUser: cannot replace a user without a user ID");n||"function"!=typeof r||(n=r,r=null),i.kuzzle.query(this.buildQueryArgs("replaceUser"),o,r,n&&function(e,t){n(e,e?void 0:new u(i,t.result._id,t.result._source,t.result._meta))})},n.prototype.createRestrictedUser=function(e,t,r,n){var i=this,o={_id:e,body:t};if(t.profileIds)throw new Error("Security.createRestrictedUser: cannot provide profileIds");n||"function"!=typeof r||(n=r,r=null),i.kuzzle.query(this.buildQueryArgs("createRestrictedUser"),o,null,n&&function(e,t){n(e,e?void 0:new u(i,t.result._id,t.result._source))})},n.prototype.updateUser=function(e,t,r,n){var i=this,o={},l="updateUser";if(!e||"string"!=typeof e)throw new Error("Security.updateUser: cannot update an user without an user ID");return n||"function"!=typeof r||(n=r,r=null),o._id=e,o.body=t,i.kuzzle.query(this.buildQueryArgs(l),o,r,n&&function(e,t){n(e,e?void 0:new u(i,t.result._id,t.result._source,t.result._meta))}),this},n.prototype.deleteUser=function(e,t,r){var n={_id:e};return r||"function"!=typeof t||(r=t,t=null),this.kuzzle.query(this.buildQueryArgs("deleteUser"),n,t,r&&function(e,t){r(e,e?void 0:t.result._id)}),this},n.prototype.scrollUsers=function(e,t,r){var n={},i=this;if(!e)throw new Error("Security.scrollUsers: scrollId is required");return r||"function"!=typeof t||(r=t,t={}),this.kuzzle.callbackRequired("Security.scrollUsers",r),n.scrollId=e,t&&t.scroll&&(n.scroll=t.scroll),this.kuzzle.query({controller:"security",action:"scrollUsers"},n,t,function(t,n){var o=[];return t?r(t):(n.result.hits.forEach(function(e){var t=new u(i,e._id,e._source,e._meta);t.version=e._version,o.push(t)}),void r(null,{total:n.result.total,users:o,scrollId:e}))}),this},n.prototype.user=function(e,t,r){return new u(this,e,t,r)},n.prototype.isActionAllowed=function(e,t,r,n,i){var o;if(!e||"object"!=typeof e)throw new Error("rights parameter is mandatory for isActionAllowed function");if(!t||"string"!=typeof t)throw new Error("controller parameter is mandatory for isActionAllowed function");if(!r||"string"!=typeof r)throw new Error("action parameter is mandatory for isActionAllowed function");return o=e.filter(function(e){return e.controller===t||"*"===e.controller}).filter(function(e){return e.action===r||"*"===e.action}).filter(function(e){return e.index===n||"*"===e.index}).filter(function(e){return e.collection===i||"*"===e.collection}),o.some(function(e){return"allowed"===e.value})?"allowed":o.some(function(e){return"conditional"===e.value})?"conditional":"denied"},n.prototype.getUserRights=function(e,t,r){var n={_id:e},i=this;if(!e||"string"!=typeof e)throw new Error("userId parameter is mandatory for getUserRights function");r||"function"!=typeof t||(r=t,t=null),i.kuzzle.callbackRequired("Kuzzle.getUserRights",r),this.kuzzle.query(this.buildQueryArgs("getUserRights"),n,t,r&&function(e,t){r(e,e?void 0:t.result.hits)})},n.prototype.createCredentials=function(e,t,r,n,i){return i||"function"!=typeof n||(i=n,n=null),this.kuzzle.query({controller:"security",action:"createCredentials"},{_id:t,strategy:e,body:r},n,function(e,t){e?i&&i(e):i&&i(null,t.result._source)}),this},n.prototype.deleteCredentials=function(e,t,r,n){return n||"function"!=typeof r||(n=r,r=null),this.kuzzle.query({controller:"security",action:"deleteCredentials"},{strategy:e,_id:t},r,"function"!=typeof n?null:function(e,t){e?n&&n(e):n&&n(null,t.result)}),this},n.prototype.getAllCredentialFields=function(e,t){t||"function"!=typeof e||(t=e,e=null),this.kuzzle.query({controller:"security",action:"getAllCredentialFields"},{},e,"function"!=typeof t?null:function(e,r){e?t&&t(e):t&&t(null,r.result)})},n.prototype.getCredentialFields=function(e,t,r){r||"function"!=typeof t||(r=t,t=null),this.kuzzle.query({controller:"security",action:"getCredentialFields"},{strategy:e},t,"function"!=typeof r?null:function(e,t){e?r&&r(e):r&&r(null,t.result)})},n.prototype.getCredentials=function(e,t,r,n){n||"function"!=typeof r||(n=r,r=null),this.kuzzle.query({controller:"security",action:"getCredentials"},{strategy:e,_id:t},r,"function"!=typeof n?null:function(e,t){e?n&&n(e):n&&n(null,t.result)})},n.prototype.hasCredentials=function(e,t,r,n){n||"function"!=typeof r||(n=r,r=null),this.kuzzle.query({controller:"security",action:"hasCredentials"},{strategy:e,_id:t},r,"function"!=typeof n?null:function(e,t){e?n&&n(e):n&&n(null,t.result)})},n.prototype.updateCredentials=function(e,t,r,n,i){return i||"function"!=typeof n||(i=n,n=null),this.kuzzle.query({controller:"security",action:"updateCredentials"},{strategy:e,_id:t,body:r},n,"function"!=typeof i?null:function(e,t){e?i&&i(e):i&&i(null,t.result)}),this},n.prototype.validateCredentials=function(e,t,r,n,i){i||"function"!=typeof n||(i=n,n=null),this.kuzzle.query({controller:"security",action:"validateCredentials"},{strategy:e,_id:t,body:r},n,"function"!=typeof i?null:function(e,t){e?i&&i(e):i&&i(null,t.result)})},e.exports=n},function(e,t){function r(e,t){var r=t||0,i=n;return i[e[r++]]+i[e[r++]]+i[e[r++]]+i[e[r++]]+"-"+i[e[r++]]+i[e[r++]]+"-"+i[e[r++]]+i[e[r++]]+"-"+i[e[r++]]+i[e[r++]]+"-"+i[e[r++]]+i[e[r++]]+i[e[r++]]+i[e[r++]]+i[e[r++]]+i[e[r++]]}for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);e.exports=r},function(e,t,r){var n,i=window.crypto||window.msCrypto;if(i&&i.getRandomValues){var o=new Uint8Array(16);n=function(){return i.getRandomValues(o),o}}if(!n){var u=new Array(16);n=function(){for(var e,t=0;t<16;t++)0===(3&t)&&(e=4294967296*Math.random()),u[t]=e>>>((3&t)<<3)&255;return u}}e.exports=n},function(e,t,r){function n(e,t,r){var n=t&&r||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null),e=e||{};var u=e.random||(e.rng||i)();if(u[6]=15&u[6]|64,u[8]=63&u[8]|128,t)for(var l=0;l<16;++l)t[n+l]=u[l];return t||o(u)}var i=r(18),o=r(17);e.exports=n}])});
//# sourceMappingURL=kuzzle.js.map